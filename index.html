<!DOCTYPE html>
<html>
<head>
  <title>Marketplace</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">
</head>
<body>

<div class="topbar">
  <span class="logo">Marketplace</span>
  <div class="actions">
    <a href="dashboard.html">Dashboard</a>
    <a href="add.html">Post</a>
    <a href="chat.html">Chats</a>
  </div>
</div>

<div class="container" id="listings"></div>

<script type="module">
import {
  auth, db,
  onAuthStateChanged,
  collection,
  onSnapshot
} from "./firebase.js";

onAuthStateChanged(auth, user => {
  if (!user) window.location.href = "login.html";
});

onSnapshot(collection(db, "listings"), snap => {
  listings.innerHTML = "";
  snap.forEach(doc => {
    let d = doc.data();
    let div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <h3>${d.title}</h3>
      <p>${d.description}</p>
      <strong>â‚¹${d.price}</strong><br><br>
      <small>${d.email}</small><br><br>
      <button onclick="startChat('${d.email}')">Chat</button>
    `;
    listings.appendChild(div);
  });
});

window.startChat = email => {
  localStorage.setItem("chatWith", email);
  window.location.href = "chat.html";
};
</script>

</body>
</html>
